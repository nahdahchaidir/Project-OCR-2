<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PLN Access • Login System</title>
  <style>
    /* --- DEFINISI ANIMASI --- */

    @keyframes splashSequence {
        0% { opacity: 0; transform: translate(-50%, -60%) scale(0.9); }
        15% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        85% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        100% { opacity: 0; transform: translate(-50%, -40%) scale(1.05); visibility: hidden; }
    }

    @keyframes cardAppear {
        from { opacity: 0; transform: translateY(30px) scale(0.98); }
        to { opacity: 1; transform: translateY(0) scale(1); }
    }

    @keyframes fadeInUpStagger {
        from { opacity: 0; transform: translateY(15px); }
        to { opacity: 1; transform: translateY(0); }
    }

    @keyframes fadeInSimple { from { opacity: 0; } to { opacity: 1; } }

    /* --- BASE STYLES --- */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      background-color: #0097a7;
      height: 100vh;
      width: 100vw;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
      position: relative;
    }

    /* --- WELCOME CONTAINER (SPLASH) --- */
    .welcome-overlay {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 9999;
        background: #ffffff;
        box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.2);
        padding: 40px 60px;
        border-radius: 20px;
        text-align: center;
        color: #212121;
        white-space: nowrap;
        animation: splashSequence 5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
    }

    .welcome-overlay h1 {
        font-size: 36px;
        font-weight: 800;
        margin-bottom: 10px;
    }
    .welcome-overlay p {
        font-size: 16px;
        font-weight: 400;
        opacity: 0.9;
        letter-spacing: 1px;
    }
    .loader-dots {
        display: flex; gap: 5px; justify-content: center; margin-top: 15px;
    }
    .dot { width: 8px; height: 8px; background: #212121; border-radius: 50%; animation: pulse 1s infinite alternate; }
    .dot:nth-child(2) { animation-delay: 0.2s; }
    .dot:nth-child(3) { animation-delay: 0.4s; }
    @keyframes pulse { from { opacity: 0.4; transform: scale(0.8); } to { opacity: 1; transform: scale(1.2); } }

    /* --- LOGIN CARD --- */
    .login-card {
      display: flex;
      flex-direction: row;
      width: 100%;
      max-width: 900px;
      height: 550px;
      background: white;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 15px 35px rgba(0,0,0,0.25);
      opacity: 0;
      animation: cardAppear 0.8s ease-out 4.2s forwards;
    }

    /* --- FORM SECTION --- */
    .form-section {
      width: 45%;
      padding: 40px;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    /* Animasi Stagger */
    .animate-stagger { opacity: 0; animation: fadeInUpStagger 0.6s ease-out forwards; }
    .delay-1 { animation-delay: 4.4s; }
    .delay-2 { animation-delay: 4.6s; }
    .delay-3 { animation-delay: 4.8s; }
    .delay-4 { animation-delay: 5.0s; }

    /* Styles Form */
    .brand-header { display: flex; align-items: center; gap: 12px; margin-bottom: 25px; }
    .brand-icon { width: 36px; height: 36px; background: #fff3e0; border-radius: 50%; display: flex; align-items: center; justify-content: center; }
    .brand-text h3 { color: #0277bd; font-size: 15px; margin-bottom: 2px; }
    .brand-text p { font-size: 11px; color: #757575; }
    h1.login-title { font-size: 28px; color: #212121; margin-bottom: 8px; }
    p.login-subtitle { font-size: 14px; color: #757575; margin-bottom: 30px; }

    .input-group { margin-bottom: 15px; }
    .input-label { display: block; font-size: 12px; font-weight: 600; color: #616161; margin-bottom: 6px; }
    .input-wrapper {
      background: #f5f7fa; border: 1px solid #e0e0e0; border-radius: 8px;
      padding: 0 15px; height: 45px; display: flex; align-items: center; gap: 10px; transition: all 0.3s;
    }
    .input-wrapper:focus-within { border-color: #0277bd; background: #fff; }
    .input-wrapper input { border: none; background: transparent; width: 100%; outline: none; font-size: 14px; color: #424242; height: 100%; }
    .icon-svg { width: 18px; height: 18px; fill: #9e9e9e; }

    .eye-btn { background: none; border: none; cursor: pointer; padding: 0; display: flex; align-items: center; transition: transform 0.2s; }
    .eye-btn:active { transform: scale(0.9); }

    .forgot-pass { text-align: right; margin-top: -5px; margin-bottom: 18px; }
    .forgot-pass a { color: #1976d2; font-size: 12px; text-decoration: none; font-weight: 600; transition: color 0.2s; }

    .btn-login {
      background: #1976d2; color: white; border: none; width: 100%;
      padding: 14px; border-radius: 8px; font-weight: bold; font-size: 14px;
      cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 6px rgba(25, 118, 210, 0.2);
    }
    .btn-login:hover { background: #1565c0; transform: translateY(-2px); box-shadow: 0 6px 8px rgba(25, 118, 210, 0.3); }
    .btn-login:disabled { opacity: .7; cursor: not-allowed; transform:none; }

    /* Message */
    .form-msg{
      margin-top: 12px;
      font-size: 12px;
      line-height: 1.5;
      color: #d32f2f;
      min-height: 18px;
    }
    .form-msg.ok{ color: #2e7d32; }

    /* --- ILLUSTRATION SECTION --- */
    .illustration-section {
      width: 55%;
      background-color: #1a237e;
      position: relative;
      overflow: hidden;
      opacity: 0;
      animation: fadeInSimple 1.2s ease-out 5.2s forwards;
    }
    .secure-badge {
      position: absolute; top: 25px; right: 25px;
      background: rgba(0,0,0,0.4); color: #81d4fa;
      padding: 6px 14px; border-radius: 20px;
      font-size: 11px; font-weight: bold; letter-spacing: 0.5px;
      border: 1px solid rgba(129, 212, 250, 0.3);
      z-index: 10; backdrop-filter: blur(4px);
    }

    /* Responsive */
    @media (max-width: 768px) {
      .welcome-overlay { padding: 30px; width: 85%; white-space: normal; }
      .welcome-overlay h1 { font-size: 28px; }
      .login-card { flex-direction: column; height: auto; max-width: 90%; }
      .form-section { width: 100%; padding: 30px; }
      .illustration-section { display: none; }
      .animate-stagger { opacity: 1; animation: none; }
      .login-card { animation-delay: 4.5s; opacity: 0; animation-fill-mode: forwards; }
    }
  </style>
</head>

<body>

  <div class="welcome-overlay">
     <h1>Selamat Datang</h1>
     <p>Sistem Portal Internal PLN Access</p>
     <div class="loader-dots">
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
     </div>
  </div>

  <div class="login-card">
    <div class="form-section">
      <div class="brand-header animate-stagger delay-1">
        <div class="brand-icon">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="#ff9800"><path d="M7 2v11h3v9l7-12h-4l4-8z"/></svg>
        </div>
        <div class="brand-text">
           <h3>PLN Access</h3>
           <p>Portal Internal • Autentikasi Aman</p>
        </div>
      </div>

      <div class="animate-stagger delay-2">
        <h1 class="login-title">Login</h1>
        <p class="login-subtitle">Silakan Masukkan Username dan Password</p>
      </div>

      <form id="loginForm" autocomplete="off">
        <div class="animate-stagger delay-3">

          <div class="input-group">
            <label class="input-label" for="usernameField">Username</label>
            <div class="input-wrapper">
              <svg class="icon-svg" viewBox="0 0 24 24"><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/></svg>
              <!-- FIX: id + name -->
              <input type="text" id="usernameField" name="username" placeholder="Masukkan Username" required>
            </div>
          </div>

          <div class="input-group">
            <label class="input-label" for="passwordField">Password</label>
            <div class="input-wrapper">
              <svg class="icon-svg" viewBox="0 0 24 24"><path d="M12.65 10C11.83 7.67 9.61 6 7 6c-3.31 0-6 2.69-6 6s2.69 6 6 6c2.61 0 4.83-1.67 5.65-4H17v4h4v-4h2v-4H12.65zM7 14c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"/></svg>
              <!-- FIX: name password -->
              <input type="password" id="passwordField" name="password" placeholder="••••••••" required>
              <button type="button" class="eye-btn" id="toggleEye" aria-label="Tampilkan password">
                <svg width="20" height="20" fill="#bdbdbd" viewBox="0 0 24 24">
                  <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
                </svg>
              </button>
            </div>
          </div>

        </div>

        <div class="animate-stagger delay-4">
          <div class="forgot-pass"><a href="#" onclick="return false;">Lupa Password?</a></div>
          <button type="submit" class="btn-login" id="loginBtn">Masuk Sistem</button>
          <div id="formMsg" class="form-msg"></div>
        </div>
      </form>
    </div>

    <div class="illustration-section">
      <div class="secure-badge">● SYSTEM SECURE</div>
      <svg viewBox="0 0 800 600" preserveAspectRatio="xMidYMid slice" xmlns="http://www.w3.org/2000/svg" style="width: 100%; height: 100%; display: block;">
        <rect x="0" y="0" width="800" height="600" fill="#1a237e" />
        <circle cx="650" cy="100" r="80" fill="#ffffff" opacity="0.05" />
        <rect x="0" y="500" width="800" height="100" fill="#263238" />
        <g transform="translate(500, 420)">
          <rect x="0" y="0" width="200" height="80" fill="#37474f" />
          <rect x="20" y="20" width="50" height="30" fill="#fdd835" opacity="0.8" />
          <rect x="120" y="40" width="40" height="40" fill="#546e7a" />
        </g>
        <g transform="translate(80, 120)">
          <path d="M50,380 L100,0 L150,380" stroke="#90a4ae" stroke-width="8" fill="none" />
          <line x1="60" y1="80" x2="140" y2="80" stroke="#90a4ae" stroke-width="5" />
          <line x1="40" y1="160" x2="160" y2="160" stroke="#90a4ae" stroke-width="5" />
          <line x1="20" y1="240" x2="180" y2="240" stroke="#90a4ae" stroke-width="5" />
          <line x1="160" y1="160" x2="160" y2="220" stroke="#795548" stroke-width="3" stroke-dasharray="5,2"/>
        </g>
        <g transform="translate(320, 300)">
          <rect x="-30" y="40" width="30" height="110" fill="#455a64" />
          <rect x="0" y="20" width="160" height="130" rx="5" fill="#607d8b" />
          <g transform="translate(40, -40)">
            <rect x="0" y="0" width="15" height="60" fill="#8d6e63" rx="2" />
            <path d="M-5,10 h25 M-5,30 h25 M-5,50 h25" stroke="#5d4037" stroke-width="2" />
          </g>
          <g transform="translate(100, -40)">
            <rect x="0" y="0" width="15" height="60" fill="#8d6e63" rx="2" />
            <path d="M-5,10 h25 M-5,30 h25 M-5,50 h25" stroke="#5d4037" stroke-width="2" />
          </g>
          <path transform="translate(65, 80)" d="M15,0 L30,25 L0,25 Z" fill="#ffeb3b" />
          <path transform="translate(65, 80)" d="M13,8 L17,8 L10,18 L16,18 L10,24" stroke="black" stroke-width="1.5" fill="none" />
        </g>
        <path d="M180,250 Q280,300 365,280" stroke="#00e5ff" stroke-width="2" fill="none" opacity="0.6" />
        <path d="M440,280 L550,420" stroke="#424242" stroke-width="3" />
      </svg>
    </div>
  </div>

  <script>
    // ===== Toggle show/hide password =====
    const toggleBtn = document.getElementById('toggleEye');
    const passInput = document.getElementById('passwordField');
    if (toggleBtn && passInput) {
      toggleBtn.addEventListener('click', () => {
        const isPassword = passInput.getAttribute('type') === 'password';
        passInput.setAttribute('type', isPassword ? 'text' : 'password');
        toggleBtn.querySelector('svg').style.fill = isPassword ? '#1976d2' : '#bdbdbd';
      });
    }

    // ===== Login + Redirect =====
    const API_LOGIN = "http://localhost/AMZAH/api/login.php";

    // UBAH ini kalau nama file visualisasi kamu beda
    const VISUAL_PAGE = "5 - Fix - Visualisasi_data.html";

    const form = document.getElementById("loginForm");
    const msg = document.getElementById("formMsg");
    const btn = document.getElementById("loginBtn");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const username = document.getElementById("usernameField").value.trim();
      const password = document.getElementById("passwordField").value;

      msg.classList.remove("ok");
      msg.textContent = "";

      btn.disabled = true;
      btn.textContent = "Memproses...";

      try {
        const res = await fetch(API_LOGIN, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ username, password })
        });

        const data = await res.json();

        if (!data.ok) {
          msg.textContent = data.message || "Login gagal.";
          btn.disabled = false;
          btn.textContent = "Masuk Sistem";
          return;
        }

        // simpan token dan user
        localStorage.setItem("pln_token", data.token);
        localStorage.setItem("pln_user", JSON.stringify(data.user));

        msg.classList.add("ok");
        msg.textContent = "Login berhasil. Mengalihkan...";

        // redirect
        setTimeout(() => {
          window.location.href = encodeURI(VISUAL_PAGE);
        }, 400);

      } catch (err) {
        msg.textContent = "Tidak bisa terhubung ke server. Pastikan Laragon berjalan.";
        btn.disabled = false;
        btn.textContent = "Masuk Sistem";
      }
    });
  </script>
</body>
</html>
